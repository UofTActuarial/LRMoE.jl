<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Data Simulation · LRMoE.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">LRMoE.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Overview</a></li><li><a class="tocitem" href="../../../framework/">Modelling Framework</a></li><li><a class="tocitem" href="../../../experts/">Expert Functions</a></li><li><a class="tocitem" href="../../../init/">Model Initialization</a></li><li><a class="tocitem" href="../../../fit/">Fitting Function</a></li><li><a class="tocitem" href="../../../predictive/">Predictive Functions</a></li><li><span class="tocitem">Examples &amp; Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Data Simulation</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Data-Simulation"><span>Data Simulation</span></a></li><li><a class="tocitem" href="#Complete-Data"><span>Complete Data</span></a></li><li><a class="tocitem" href="#Truncation-and-Censoring"><span>Truncation and Censoring</span></a></li></ul></li><li><a class="tocitem" href="../../../data_format/">Data Formatting</a></li><li><a class="tocitem" href="../../sim_fit/simulate_fit/">Fitting Function</a></li><li><a class="tocitem" href="../../../customize/">Adding Customized Expert Functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples &amp; Tutorials</a></li><li class="is-active"><a href>Data Simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Data Simulation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sparktseung/LRMoE.jl/blob/master/docs/src/examples/sim_data/simulate_data.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h1><p>This document contains the data generation process for the dataset accompanying  the <code>LRMoE.jl</code> package (see <a href="https://github.com/sparktseung/LRMoE-jl-demo">here</a>). This also serves as an example of using the <code>sim_dataset</code> function  included in the package.</p><h1 id="Data-Simulation"><a class="docs-heading-anchor" href="#Data-Simulation">Data Simulation</a><a id="Data-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Simulation" title="Permalink"></a></h1><h2 id="Complete-Data"><a class="docs-heading-anchor" href="#Complete-Data">Complete Data</a><a id="Complete-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-Data" title="Permalink"></a></h2><p>Suppose there is an auto-insurance company with two lines of business, with a total of 10,000 policies.  The policyholder information includes sex (1 for Male and 0 for Female), driver&#39;s age (with range 20 - 80),  car age (with range 0 - 10), and region (1 for urban and 0 for rural).  We assume all covariates are uniformly and independently drawn at random.</p><pre><code class="language-julia"># Random seed for reproducible results
Random.seed!(7777)
sample_size = 10000

intercept = fill(1.0, sample_size)
sex = rand(Binomial(1, 0.50), sample_size)
aged = rand(Uniform(20, 80), sample_size)
agec = rand(Uniform(0, 10), sample_size)
region = rand(Binomial(1, 0.50), sample_size)

X = DataFrame(intercept = intercept, sex= sex, 
              aged = aged, agec = agec, region = region)</code></pre><p>The first few rows of <code>X</code> are shown below.</p><pre><code class="language-none">5×5 DataFrame
 Row │ intercept  sex    aged     agec     region
     │ Float64    Int64  Float64  Float64  Int64
─────┼────────────────────────────────────────────
   1 │       1.0      1  56.4367  3.3857        1
   2 │       1.0      1  29.7025  2.31892       1
   3 │       1.0      1  33.4796  8.61125       0
   4 │       1.0      0  38.7478  2.88865       1
   5 │       1.0      1  47.348   9.01135       0</code></pre><p>For simplicity, we assume there are two latent risk classes: low (L) and high (H).  The characteristics for the high-risk class are male, young age, old car age and urban region.  This is specified by the following matrix of logit regression coefficients,  where the second row represents the reference class.</p><pre><code class="language-julia">α = [-0.5 1.0 -0.05 0.1 1.25;
      0.0 0.0   0.0 0.0  0.0]</code></pre><p>We consider a two-dimensional response: claim frequency from the first business line,  and claim severity from the second business line.  For demonstration purposes and for simplicity, we don&#39;t consider the same business line to avoid the complication  where zero frequency necessarily implies zero severity.  The component distributions and their parameters are specified as follows.</p><pre><code class="language-julia">comp_dist = [PoissonExpert(6.0)         ZIGammaCountExpert(0.20, 30, 0.50);
             LogNormalExpert(4.0, 0.3)  InverseGaussianExpert(20, 20)]</code></pre><p>The <code>LRMoE.jl</code> package includes a simulator. Given the covariates and parameters defined above,  we can directly simulate a dataset.</p><pre><code class="language-julia">Y_complete = LRMoE.sim_dataset(α, X, comp_dist)</code></pre><p>The simulated values are plotted as follows.  For each dimension of <code>Y</code>, the histogram is relatively well separated as two components.  This is more or less done on purpose to demonstrate that the fitting procedure can identify the <em>true</em> model  when it is known.  In practice, we are usually less concerned of the underlying data generating distribution,  as long as the LRMoE model provides a reasonable fit of data.</p><p><img src="../figures/simulate_data_7_1.png" alt/></p><p><img src="../figures/simulate_data_8_1.png" alt/></p><h2 id="Truncation-and-Censoring"><a class="docs-heading-anchor" href="#Truncation-and-Censoring">Truncation and Censoring</a><a id="Truncation-and-Censoring-1"></a><a class="docs-heading-anchor-permalink" href="#Truncation-and-Censoring" title="Permalink"></a></h2><p>One distinct feature of <code>LRMoE</code> is dealing with data truncation and censoring,  which is common in insurance contexts.  Consequently, instead of one single number for each dimension <code>d</code>, a tuple <code>(tl_d, yl_d, yu_d, tu_d)</code> is required,   where <code>tl_d</code>/<code>tu_d</code> are the lower/upper bounds of truncation, and <code>yl_d</code>/<code>yu_d</code> are the lower/upper bounds of censoring.</p><p>For illustration purposes, we assume the dataset is subject to the following truncation and censoring.</p><table><tr><th style="text-align: right">Index</th><th style="text-align: right"><code>Y_complete[:,1]</code></th><th style="text-align: right"><code>Y_complete[:,2]</code></th></tr><tr><td style="text-align: right">1-6000</td><td style="text-align: right">No truncation  or censoring</td><td style="text-align: right">No truncation  or censoring</td></tr><tr><td style="text-align: right">6001-8000</td><td style="text-align: right">No truncation  or censoring</td><td style="text-align: right">Left Truncated at 5</td></tr><tr><td style="text-align: right">8001-10000</td><td style="text-align: right">No truncation  or censoring</td><td style="text-align: right">Right Censored at 100</td></tr></table><pre><code class="language-julia"># First block: 1~6000
X_obs = X[1:6000,:]

tl_1 = fill(0.0, 6000)
yl_1 = Y_complete[1:6000, 1]
yu_1 = Y_complete[1:6000, 1]
tu_1 = fill(Inf, 6000) 

tl_2 = fill(0.0, 6000)
yl_2 = Y_complete[1:6000, 2]
yu_2 = Y_complete[1:6000, 2]
tu_2 = fill(Inf, 6000) 

# Second block: 6001~8000
keep_idx = Y_complete[6001:8000,2] .&gt;=  5
keep_length = sum(keep_idx) # 1837 out of 2000

append!(X_obs, X[6001:8000,:][keep_idx,:])

append!(tl_1, fill(0.0, keep_length))
append!(yl_1, Y_complete[6001:8000, 1][keep_idx])
append!(yu_1, Y_complete[6001:8000, 1][keep_idx])
append!(tu_1, fill(Inf, keep_length))

y_temp = Y_complete[6001:8000, 2][keep_idx]
append!(tl_2, fill(5.0, keep_length))
append!(yl_2, Y_complete[6001:8000, 2][keep_idx])
append!(yu_2, Y_complete[6001:8000, 2][keep_idx])
append!(tu_2, fill(Inf, keep_length))

# Third block: 8001~10000
append!(X_obs, X[8001:10000,:])

append!(tl_1, fill(0.0, 2000))
append!(yl_1, Y_complete[8001:10000, 1])
append!(yu_1, Y_complete[8001:10000, 1])
append!(tu_1, fill(Inf, 2000))

y_temp = Y_complete[8001:10000, 2]
censor_idx = y_temp .&gt;= 100.0 # 21 out of 2000
yl_temp = copy(y_temp)
yl_temp[censor_idx] .= 100
yu_temp = copy(y_temp)
yu_temp[censor_idx] .= Inf
append!(tl_2, fill(0.0, 2000))
append!(yl_2, yl_temp)
append!(yu_2, yu_temp)
append!(tu_2, fill(Inf, 2000))

# Put things together
Y_obs = DataFrame(tl_1 = tl_1, yl_1 = yl_1, yu_1 = yu_1, tu_1 = tu_1,
                  tl_2 = tl_2, yl_2 = yl_2, yu_2 = yu_2, tu_2 = tu_2)</code></pre><p>As a result of truncating <code>Y_complete[:,2]</code>, 163 rows are discarded,  leaving 9837 observations available for model fitting. Sample data points are show below.</p><pre><code class="language-none">3×4 DataFrame
 Row │ tl_1     yl_1     yu_1     tu_1
     │ Float64  Float64  Float64  Float64
─────┼────────────────────────────────────
   1 │     0.0      6.0      6.0     Inf
   2 │     0.0      8.0      8.0     Inf
   3 │     0.0      7.0      7.0     Inf</code></pre><pre><code class="language-none">3×4 DataFrame
 Row │ tl_2     yl_2      yu_2      tu_2
     │ Float64  Float64   Float64   Float64
─────┼──────────────────────────────────────
   1 │     0.0   89.0332   89.0332     Inf
   2 │     5.0   37.4133   37.4133     Inf
   3 │     0.0  100.0     Inf          Inf</code></pre><p>We will export both the complete and incomplete datasets to the <code>LRMoE.jl</code> package.</p><pre><code class="language-julia">@save &quot;X_complete.jld2&quot; X
@save &quot;Y_complete.jld2&quot; Y_complete
@save &quot;X_obs.jld2&quot; X_obs
@save &quot;Y_obs.jld2&quot; Y_obs</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../predictive/">« Predictive Functions</a><a class="docs-footer-nextpage" href="../../../data_format/">Data Formatting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 4 May 2021 00:14">Tuesday 4 May 2021</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
